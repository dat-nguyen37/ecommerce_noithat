{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport ProductItem from '@/components/productItem/ProductItem.vue';\nimport { imgDb } from '../firebase';\nimport { ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage';\nimport axios from 'axios';\nexport default {\n  name: \"ProductDetailView\",\n  components: {\n    ProductItem\n  },\n  props: ['getCart', 'getCountCart'],\n  data() {\n    return {\n      productId: this.$route.params.id,\n      percent: 0,\n      data: {},\n      star: 1,\n      listproduct: [],\n      quantity: 1,\n      description: '',\n      image: [],\n      open: false,\n      listComment: [],\n      page: 1,\n      limit: 10,\n      count: 0,\n      average: 0\n    };\n  },\n  mounted() {\n    this.getProduct();\n    this.getComment();\n  },\n  watch: {\n    '$route.params.id': function (newProductId) {\n      this.productId = newProductId;\n      this.getProduct();\n    }\n  },\n  methods: {\n    openDescription() {\n      this.open = true;\n    },\n    openComment() {\n      this.open = false;\n    },\n    remove(index) {\n      this.image.splice(index, 1);\n    },\n    async getProduct() {\n      try {\n        const res = await axios.get('product/' + this.productId);\n        this.data = res.data;\n        this.getProductByCategoryId();\n      } catch (err) {\n        alert('Loi!');\n      }\n    },\n    async getProductByCategoryId() {\n      try {\n        const res = await axios.get(`product/category/${this.data[0].categoryId}`);\n        this.listproduct = res.data;\n      } catch (err) {\n        alert('Loi!');\n      }\n    },\n    incrementQuantity() {\n      if (this.quantity > 1) {\n        this.quantity--;\n      }\n    },\n    decrementQuantity() {\n      if (this.quantity < 10) {\n        this.quantity++;\n      }\n    },\n    async handleAddToCart(id, price) {\n      try {\n        await axios.post('cart/create', {\n          productId: id,\n          quantity: this.quantity,\n          totalAmount: price * this.quantity\n        });\n        this.getCountCart();\n        alert(\"Add to cart success\");\n      } catch (err) {\n        alert(\"Loi!\");\n      }\n    },\n    async handleImageChange(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      try {\n        const imgRef = ref(imgDb, `/ecommerce/comment/${file.name}`);\n        const uploadTask = uploadBytesResumable(imgRef, file);\n        uploadTask.on(\"state_changed\", snapshot => {\n          this.percent = Math.round(snapshot.bytesTransferred / snapshot.totalBytes * 100);\n        }, err => console.log(err), async () => {\n          const url = await getDownloadURL(uploadTask.snapshot.ref);\n          this.image.push(url);\n        });\n      } catch (err) {\n        console.error(\"Error uploading image:\", err);\n      }\n    },\n    async handleComment() {\n      try {\n        await axios.post('comment/create/' + this.productId, {\n          description: this.description,\n          image: this.image,\n          star: this.star\n        });\n        this.getComment();\n      } catch (err) {\n        alert(\"Loi!\");\n      }\n    },\n    async getComment() {\n      try {\n        const res = await axios.get(`comment/getAll/${this.productId}`);\n        this.listComment = res.data;\n        this.average = res.data.average;\n        this.count = res.data.count;\n      } catch (err) {\n        alert(\"Loi!\");\n      }\n    }\n  }\n};","map":{"version":3,"names":["ProductItem","imgDb","ref","uploadBytesResumable","getDownloadURL","axios","name","components","props","data","productId","$route","params","id","percent","star","listproduct","quantity","description","image","open","listComment","page","limit","count","average","mounted","getProduct","getComment","watch","$route.params.id","newProductId","methods","openDescription","openComment","remove","index","splice","res","get","getProductByCategoryId","err","alert","categoryId","incrementQuantity","decrementQuantity","handleAddToCart","price","post","totalAmount","getCountCart","handleImageChange","event","file","target","files","imgRef","uploadTask","on","snapshot","Math","round","bytesTransferred","totalBytes","console","log","url","push","error","handleComment"],"sources":["src/views/ProductDetailView.vue"],"sourcesContent":["<template>\r\n    <div class=\"max-w-6xl h-auto mx-auto\">\r\n        <div class=\"max-w-6xl border-b mx-auto py-2\">\r\n            <h6><router-link :to=\"{name:'home'}\">Trang chủ</router-link> / <span class=\"text-gray-500\">{{ data[0].name }}</span></h6>\r\n        </div>\r\n        <div class=\"grid grid-cols-12 gap-4\">\r\n            <div class=\"col-span-7\">\r\n                <img :src=\"data[0].image\" alt=\"\">\r\n            </div>\r\n            <div class=\"col-span-5\">\r\n                <div class=\"py-2 border-b-2 border-black \">\r\n                    <h1 class=\"font-bold\">{{ data[0].name }}</h1>\r\n                    <span>MÃ SP: {{ data[0].id }}</span>\r\n                </div>\r\n                <div class=\"text-center text-4xl border-b text-red-500\">{{ data[0].price*quantity | numeral}} VND    </div>\r\n                <div class=\"w-full\">\r\n                    <label for=\"\">Số lượng:</label>\r\n                    <div class=\"flex mt-4 text-4xl\">\r\n                        <button type=\"button\" class=\"border border-black w-10 h-10 text-center\" @click=\"incrementQuantity\">-</button>\r\n                        <input type=\"number\" name=\"quantity\" v-model=\"quantity\" placeholder=\"1\" min=\"1\" class=\"w-14 text-center border border-black\">\r\n                        <button type=\"button\" class=\"border border-black w-10 h-10 text-center\" @click=\"decrementQuantity\">+</button>\r\n                    </div>\r\n                    <button class=\"mt-4 w-full h-14 bg-[#271511] text-white text-3xl rounded-md flex items-center px-2\" @click=\"handleAddToCart(data[0].id,data[0].price)\">\r\n                        <font-awesome-icon icon=\"shopping-cart\" class=\"\" />\r\n                        <span class=\"mx-auto\">Đặt hàng</span>\r\n                    </button>\r\n                    <button class=\"mt-4 w-full h-14 bg-[#271511] text-white text-3xl rounded-md flex items-center px-2\">\r\n                        <div class=\"w-12 h-12 border-2 rounded-full flex justify-center items-center\">\r\n                            <font-awesome-icon icon=\"phone\" class=\"\" />\r\n                        </div>\r\n                        <a href=\"tel:19002812\" class=\"mx-auto\">19002812</a>\r\n                    </button>\r\n                    <div class=\"mt-4\">\r\n                       <h1>Địa chỉ mua hàng:</h1>\r\n                       <p>Showroom 1: Thái thịnh, Đống Đa, Hà Nội</p>\r\n                    </div>\r\n                    <p class=\"font-bold\">Thể loại: {{ data[0].categoryName }}</p>\r\n                </div>\r\n            </div>\r\n            <div class=\"col-span-8 border\">\r\n                <div class=\"grid grid-cols-2 gap-1\">\r\n                    <div class=\"h-10 bg-[#271511] text-white leading-10 text-center hover:cursor-pointer\" @click=\"openDescription\">\r\n                        Thông tin sản phẩm\r\n                    </div>\r\n                    <div class=\"h-10 bg-[#271511] text-white leading-10 text-center hover:cursor-pointer\" @click=\"openComment\">\r\n                        Đánh giá nhận xét ({{ average }}/5)\r\n                    </div>\r\n                </div>\r\n                <div v-if=\"open\" class=\"p-4\"><p>{{ data[0].description }}</p></div>\r\n                <div v-else class=\"p-4 bg-blue-300\">\r\n                    <div class=\"border p-2 h-[150vh] bg-white\">\r\n                        <h1 class=\"uppercase font-bold\">Đánh giá của bạn:</h1>\r\n                        <select name=\"star\" v-model=\"star\" id=\"\" class=\"border-2 w-56 my-2\">\r\n                            <option value=\"1\" selected>1sao</option>\r\n                            <option value=\"2\">2sao</option>\r\n                            <option value=\"3\">3sao</option>\r\n                            <option value=\"4\">4sao</option>\r\n                            <option value=\"5\">5sao</option>\r\n                        </select>\r\n                        <h1 class=\"uppercase font-bold\">Nhận xét của bạn:</h1>\r\n                        <textarea name=\"\" v-model=\"description\" id=\"\" class=\"border w-full p-1\" placeholder=\"nhận xét ...\"></textarea>\r\n                        <div class=\"flex bottom-2 overflow-x-auto justify-between\">\r\n                            <div class=\" w-[90vh] flex\">\r\n                                <label for=\"file\" class=\"\"><font-awesome-icon icon=\"camera\" class=\"p-6 border-4 text-2xl block hover:cursor-pointer\"/></label>\r\n                                <div v-if=\"image\" class=\"flex\">\r\n                                    <div v-for=\"(img,index) in image\" :key=\"index\" class=\"relative\">\r\n                                        <img :src=\"img\" alt=\"\" class=\"w-20 h-20 border-2 text-2xl block hover:cursor-pointer\">\r\n                                        <font-awesome-icon icon=\"close\" @click=\"remove(index)\" class=\"absolute top-0 right-0 p-1 hover:cursor-pointer border bg-slate-100 rounded-[50%]\"/>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                                <input type=\"file\" hidden id=\"file\" name=\"image\" @change=\"handleImageChange\">\r\n                                <button type=\"button\" class=\"py-2 px-4 border bg-blue-500 h-10 self-center rounded-sm\" @click=\"handleComment\">Send</button>\r\n                        </div>\r\n                        <div class=' mt-3 border-4 border-black h-[105vh] p-2 relative'>\r\n                            <h1>Comments ({{ count }})</h1>\r\n                            <div class=\"h-[90vh] overflow-y-auto\">\r\n                                <div v-for=\"item in listComment.data\" :key=\"item.comment._id\" class='border-b'>\r\n                                <div class='flex mt-3 items-center'>\r\n                                    <div class=\"border w-10 h-10 rounded-[50%]\" >\r\n                                        <img :src=\"item.image\" alt=\"\" class='rounded-[50%]'/> \r\n                                    </div>\r\n                                    <div class='mx-2'>\r\n                                        <span class=\"text-md\">{{item.name}}</span> <br/>\r\n                                        <font-awesome-icon v-for=\"starIndex in parseInt(item.comment.star)\" icon=\"star\" :key=\"starIndex\" class=\"text-[10px] text-yellow-300\"/>\r\n                                        <p class=\"text-[10px]\">{{item.comment.createdAt}}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <div class='my-2 px-2'>\r\n                                    <span>{{item.comment.description}}</span>\r\n                                    <img v-for=\"(img,index) in item.comment.image\" :key=\"index\" :src=\"img\" alt=\"\" class=\"w-10 h-10\">\r\n                                </div>\r\n                            </div>\r\n                            </div>\r\n                            <button class=\"w-full text-center bg-[#271511] text-white leading-8\"@>Xem thêm bình luận</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"col-span-4 border\">\r\n                <div class=\"w-full h-10 bg-[#271511] text-white text-center leading-10\">\r\n                    LÍ DO BẠN NÊN CHỌN\r\n                </div>\r\n                <div class=\"w-full flex flex-col p-2\">\r\n                    <img src=\"https://pos.nvncdn.com/940d71-40111/store/20181231_500uZWWGMYZ6cglXbfR81lgJ.png\" alt=\"\" class=\"w-40 h-20 self-center\">\r\n                    <ul class=\" mt-2\">\r\n                        <li class=\"relative py-2\">Thương hiệu - dịch vụ Việt Nam phát triển bền vững do Chủ tịch nước trao tặng</li>\r\n                        <li class=\"relative py-2\">Là doanh nghiệp tiêu biểu trong lĩnh vực Kiến trúc- Nội thất</li>\r\n                        <li class=\"relative py-2\">Đội ngũ kiến trúc sư giàu kinh nghiệm, xu hướng thiết kế hiện đại</li>\r\n                        <li class=\"relative py-2\">Chế độ bảo hành tại nhà, bảo trì vĩnh viễn tất cả sản phẩm</li>\r\n                        <li class=\"relative py-2\">Vận chuyển miễn phí cho khu vụ nội thành hoặc 50km đầu</li>\r\n                        <li class=\"relative py-2\">Kiểm tra hàng, thanh toán tại nhà khi nhận hàng</li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"w-full mt-5\">\r\n            <div class=\"h-10 bg-[#271511] text-white leading-10 text-center text-2xl uppercase\">\r\n                        Sản phẩm liên quan\r\n            </div>\r\n            <div class=\" grid grid-rows-1 grid-cols-4 gap-3 p-2\">\r\n                <ProductItem v-for=\"item in listproduct\" :key=\"item._id\" :item=\"item\"/>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport ProductItem from '@/components/productItem/ProductItem.vue';\r\nimport {imgDb} from '../firebase'\r\nimport { ref, uploadBytesResumable,getDownloadURL } from 'firebase/storage'\r\nimport axios from 'axios'\r\nexport default {\r\n    name:\"ProductDetailView\",\r\n    components:{ProductItem},\r\n    props:['getCart','getCountCart'],\r\n    data(){\r\n        return{\r\n            productId:this.$route.params.id,  \r\n            percent:0,\r\n            data:{},\r\n            star:1,\r\n            listproduct:[],\r\n            quantity:1,\r\n            description:'',\r\n            image:[],\r\n            open:false,\r\n            listComment:[],\r\n            page:1,\r\n            limit:10,\r\n            count:0,\r\n            average:0\r\n        }\r\n    },\r\n    mounted(){\r\n        this.getProduct()\r\n        this.getComment()\r\n    },\r\n    watch: {\r\n        '$route.params.id': function(newProductId) {\r\n            this.productId = newProductId;\r\n            this.getProduct();\r\n        }\r\n    },\r\n    methods:{\r\n        openDescription(){\r\n            this.open=true\r\n        },\r\n        openComment(){\r\n            this.open=false\r\n        },\r\n        remove(index) {\r\n            this.image.splice(index, 1); \r\n        },\r\n        async getProduct(){\r\n            try {\r\n                const res=await axios.get('product/'+this.productId)\r\n                this.data=res.data\r\n                this.getProductByCategoryId()\r\n            } catch (err) {\r\n                alert('Loi!')\r\n            }\r\n        },\r\n        async getProductByCategoryId(){\r\n            try {\r\n                const res=await axios.get(`product/category/${this.data[0].categoryId}`)\r\n                this.listproduct=res.data\r\n            } catch (err) {\r\n                alert('Loi!')\r\n            }\r\n        },\r\n        incrementQuantity(){\r\n            if(this.quantity>1){\r\n                this.quantity--\r\n            }\r\n        },\r\n        decrementQuantity(){\r\n            if(this.quantity<10){\r\n                this.quantity++\r\n            }\r\n        },\r\n        async handleAddToCart(id,price){\r\n            try {\r\n                await axios.post('cart/create',{\r\n                    productId:id,\r\n                    quantity:this.quantity,\r\n                    totalAmount:price*this.quantity\r\n                })\r\n                this.getCountCart()\r\n                alert(\"Add to cart success\")\r\n            } catch (err) {\r\n                alert(\"Loi!\")\r\n            }\r\n        },\r\n        async handleImageChange(event) {\r\n            const file = event.target.files[0];\r\n            if (!file) return;\r\n            try {\r\n                const imgRef = ref(imgDb, `/ecommerce/comment/${file.name}`);\r\n                const uploadTask = uploadBytesResumable(imgRef, file);\r\n                uploadTask.on(\r\n                    \"state_changed\",\r\n                    (snapshot) => {\r\n                        this.percent = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);\r\n                    },\r\n                    (err) => console.log(err),\r\n                    async () => {\r\n                        const url = await getDownloadURL(uploadTask.snapshot.ref);\r\n                        this.image.push(url);\r\n                    }\r\n                );\r\n            } catch (err) {\r\n                console.error(\"Error uploading image:\", err);\r\n            }\r\n        },\r\n        async handleComment(){\r\n            try {\r\n                await axios.post('comment/create/'+this.productId,{\r\n                    description:this.description,\r\n                    image:this.image,\r\n                    star:this.star\r\n                })\r\n                this.getComment()\r\n            } catch (err) {\r\n                alert(\"Loi!\")\r\n            }\r\n        },\r\n        async getComment(){\r\n            try {\r\n                const res=await axios.get(`comment/getAll/${this.productId}`)\r\n                this.listComment=res.data\r\n                this.average=res.data.average\r\n                this.count=res.data.count\r\n\r\n            } catch (err) {\r\n                alert(\"Loi!\")\r\n            }\r\n        },\r\n    }\r\n}\r\n</script>\r\n<style lang=\"css\" scoped>\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}